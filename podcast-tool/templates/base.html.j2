<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ meta.title }} | Êí≠ÂÆ¢ÂèØËßÜÂåñ</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: {{ theme.bg_color | default('#0a0a0f') }};
  --bg2: #0f0f18;
  --bg3: #13131f;
  --gold: {{ theme.primary_color | default('#d4a017') }};
  --gold-light: #f0c040;
  --amber: {{ theme.accent_color | default('#c07830') }};
  --text: #e8e0d0;
  --text-dim: #8a8070;
  --text-muted: #5a5248;
  --accent: #e8b830;
  --danger: #c04040;
  --radius: 12px;
  --font: 'Hiragino Mincho ProN', 'Source Han Serif CN', 'Noto Serif CJK SC', Georgia, serif;
  --sans: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', system-ui, sans-serif;
}

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font);
  line-height: 1.9;
  overflow-x: hidden;
}

/* Progress bar */
#progress-bar {
  position: fixed;
  top: 0; left: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--gold), var(--gold-light));
  width: 0%;
  z-index: 1000;
  transition: width 0.1s ease;
}

/* Sections */
section {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 80px 5vw;
  position: relative;
}

/* Fade-in animations */
.reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.8s ease, transform 0.8s ease;
  will-change: transform, opacity;
}
.reveal.visible { opacity: 1; transform: translateY(0); will-change: auto; }
.reveal-delay-1 { transition-delay: 0.15s; }
.reveal-delay-2 { transition-delay: 0.3s; }
.reveal-delay-3 { transition-delay: 0.45s; }
.reveal-delay-4 { transition-delay: 0.6s; }

/* ===== HERO ===== */
#hero {
  align-items: center;
  text-align: center;
  background: radial-gradient(ellipse at center, #1a1020 0%, var(--bg) 70%);
  overflow: hidden;
}
#hero::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 20% 50%, rgba(212,160,23,0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 50%, rgba(192,120,48,0.05) 0%, transparent 50%);
  pointer-events: none;
}
.hero-ep {
  font-family: var(--sans);
  font-size: 12px;
  letter-spacing: 4px;
  color: var(--gold);
  text-transform: uppercase;
  margin-bottom: 32px;
}
.hero-title {
  font-size: clamp(56px, 12vw, 120px);
  font-weight: 900;
  letter-spacing: -2px;
  line-height: 1.1;
  background: linear-gradient(135deg, #f0d060, #d4a017, #c07830);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 16px;
}
.hero-subtitle {
  font-family: var(--sans);
  font-size: clamp(13px, 2vw, 17px);
  color: var(--text-dim);
  max-width: 600px;
  line-height: 1.7;
  margin-bottom: 56px;
}
.hero-quote {
  max-width: 680px;
  font-size: clamp(16px, 2.5vw, 22px);
  color: var(--text);
  line-height: 1.9;
  position: relative;
  padding: 32px 40px;
  border-left: 3px solid var(--gold);
  text-align: left;
  background: rgba(212,160,23,0.04);
  border-radius: 0 8px 8px 0;
  cursor: pointer;
  transition: background 0.3s;
}
.hero-quote:hover { background: rgba(212,160,23,0.08); }
.hero-quote.highlighted { background: rgba(212,160,23,0.15); }
.hero-quote::before {
  content: '"';
  position: absolute;
  top: -10px; left: 20px;
  font-size: 80px;
  color: var(--gold);
  opacity: 0.3;
  line-height: 1;
}
.scroll-hint {
  margin-top: 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  color: var(--text-muted);
  font-family: var(--sans);
  font-size: 12px;
  letter-spacing: 2px;
  animation: bounce 2s infinite;
}
.scroll-arrow {
  width: 1px; height: 48px;
  background: linear-gradient(to bottom, var(--gold), transparent);
}
@keyframes bounce {
  0%, 100% { transform: translateY(0); opacity: 0.6; }
  50% { transform: translateY(8px); opacity: 1; }
}

/* ===== SECTION COMMON ===== */
.section-label {
  font-family: var(--sans);
  font-size: 11px;
  letter-spacing: 4px;
  color: var(--gold);
  text-transform: uppercase;
  margin-bottom: 20px;
}
.section-title {
  font-size: clamp(28px, 5vw, 52px);
  font-weight: 800;
  line-height: 1.2;
  margin-bottom: 16px;
}
.section-sub {
  font-family: var(--sans);
  font-size: 15px;
  color: var(--text-dim);
  margin-bottom: 48px;
}
.section-divider {
  width: 60px; height: 2px;
  background: linear-gradient(90deg, var(--gold), transparent);
  margin: 24px 0 48px;
}

/* ===== PARTICIPANTS ===== */
.author-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 40px;
  max-width: 900px;
}
.author-card {
  background: var(--bg3);
  border: 1px solid rgba(212,160,23,0.15);
  border-radius: var(--radius);
  padding: 32px;
}
.author-card h3 {
  font-size: 20px;
  color: var(--gold);
  margin-bottom: 12px;
  font-family: var(--sans);
}
.author-card p {
  font-family: var(--sans);
  font-size: 14px;
  color: var(--text-dim);
  line-height: 1.8;
}

/* ===== BIG QUOTE ===== */
.big-quote {
  font-size: clamp(20px, 3.5vw, 36px);
  line-height: 1.8;
  max-width: 800px;
  position: relative;
  padding: 40px;
  background: linear-gradient(135deg, rgba(212,160,23,0.06), rgba(192,120,48,0.02));
  border-radius: var(--radius);
  border: 1px solid rgba(212,160,23,0.12);
  margin-bottom: 48px;
  cursor: pointer;
  transition: border-color 0.3s, background 0.3s;
}
.big-quote:hover { border-color: rgba(212,160,23,0.3); background: rgba(212,160,23,0.08); }
.big-quote.highlighted { border-color: var(--gold); background: rgba(212,160,23,0.12); }
.highlight-text { color: var(--gold-light); font-style: italic; }

/* ===== FEATURE CARDS ===== */
.feature-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
  max-width: 960px;
  margin-top: 40px;
}
.feature-card {
  background: var(--bg3);
  border: 1px solid rgba(212,160,23,0.1);
  border-radius: var(--radius);
  padding: 28px 24px;
  transition: border-color 0.3s, transform 0.3s;
}
.feature-card:hover {
  border-color: rgba(212,160,23,0.35);
  transform: translateY(-4px);
}
.feature-icon { font-size: 32px; margin-bottom: 16px; display: block; }
.feature-name {
  font-size: 18px;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 8px;
  font-family: var(--sans);
}
.feature-desc {
  font-family: var(--sans);
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.7;
}

/* ===== STORY CARDS ===== */
.story-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
  max-width: 900px;
}
.story-card {
  background: var(--bg3);
  border-radius: var(--radius);
  padding: 28px;
  border-left: 3px solid var(--amber);
}
.story-card .narrator {
  font-family: var(--sans);
  font-size: 11px;
  letter-spacing: 2px;
  color: var(--amber);
  margin-bottom: 10px;
  text-transform: uppercase;
}
.story-card p {
  font-family: var(--sans);
  font-size: 14px;
  color: var(--text-dim);
  line-height: 1.8;
}

/* ===== ACTION ITEMS ===== */
.action-items {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-width: 750px;
  margin-bottom: 48px;
}
.action-item {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  background: var(--bg3);
  border-radius: 8px;
  padding: 16px 20px;
  font-family: var(--sans);
  font-size: 14px;
  color: var(--text);
  line-height: 1.6;
}
.action-num {
  width: 24px; height: 24px;
  border-radius: 50%;
  background: var(--gold);
  color: var(--bg);
  font-size: 12px;
  font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  margin-top: 1px;
}

/* ===== MEGA QUOTE ===== */
.mega-quote {
  font-size: clamp(20px, 3.5vw, 36px);
  line-height: 1.7;
  max-width: 800px;
  font-weight: 700;
  color: var(--text);
  padding: 48px 0;
  border-top: 1px solid rgba(212,160,23,0.2);
  cursor: pointer;
  transition: color 0.2s;
}
.mega-quote span { color: var(--gold); }
.mega-quote:hover { color: var(--gold-light); }
.mega-quote.highlighted span { color: var(--gold-light); }

/* ===== QUIZ ===== */
.quiz-container { max-width: 700px; width: 100%; }
.quiz-intro {
  font-family: var(--sans);
  font-size: 15px;
  color: var(--text-dim);
  margin-bottom: 40px;
  line-height: 1.8;
}
.quiz-question { margin-bottom: 32px; }
.quiz-q-text {
  font-size: 16px;
  margin-bottom: 16px;
  line-height: 1.7;
  font-family: var(--sans);
}
.quiz-options { display: flex; gap: 8px; flex-wrap: wrap; }
.quiz-opt {
  padding: 8px 18px;
  border: 1px solid rgba(212,160,23,0.25);
  border-radius: 100px;
  font-family: var(--sans);
  font-size: 13px;
  color: var(--text-dim);
  cursor: pointer;
  transition: all 0.2s;
  background: transparent;
  user-select: none;
}
.quiz-opt:hover { border-color: var(--gold); color: var(--gold); }
.quiz-opt.selected { background: var(--gold); border-color: var(--gold); color: var(--bg); font-weight: 600; }

.quiz-slider {
  width: 100%;
  -webkit-appearance: none;
  height: 4px;
  background: linear-gradient(to right, #d4a017 0%, #d4a017 33%, #5a5248 33%, #5a5248 100%);
  border-radius: 2px;
  outline: none;
}
.quiz-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--gold);
  cursor: pointer;
  box-shadow: 0 0 0 4px rgba(212,160,23,0.2);
}
.slider-labels {
  display: flex;
  justify-content: space-between;
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 6px;
}

.quiz-btn {
  margin-top: 32px;
  padding: 14px 40px;
  background: var(--gold);
  color: var(--bg);
  border: none;
  border-radius: 100px;
  font-family: var(--sans);
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.quiz-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(212,160,23,0.3); }

.quiz-result {
  display: none;
  margin-top: 40px;
  padding: 32px;
  background: linear-gradient(135deg, rgba(212,160,23,0.08), rgba(192,120,48,0.04));
  border: 1px solid rgba(212,160,23,0.25);
  border-radius: var(--radius);
}
.quiz-result-level {
  font-size: 28px;
  font-weight: 900;
  color: var(--gold);
  margin-bottom: 8px;
  font-family: var(--sans);
}
.quiz-result-desc {
  font-family: var(--sans);
  font-size: 14px;
  color: var(--text);
  line-height: 1.8;
}

/* ===== ENDING ===== */
.book-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 24px;
  max-width: 900px;
  margin-bottom: 64px;
}
.book-card {
  background: var(--bg3);
  border-radius: var(--radius);
  padding: 28px;
  border: 1px solid rgba(212,160,23,0.12);
  transition: border-color 0.3s;
}
.book-card:hover { border-color: rgba(212,160,23,0.35); }
.book-tag {
  font-family: var(--sans);
  font-size: 10px;
  letter-spacing: 3px;
  color: var(--gold);
  margin-bottom: 10px;
  text-transform: uppercase;
}
.book-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 8px;
  line-height: 1.4;
}
.book-author {
  font-family: var(--sans);
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 14px;
}
.book-quote {
  font-family: var(--sans);
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.7;
  border-left: 2px solid var(--amber);
  padding-left: 12px;
  font-style: italic;
  cursor: pointer;
  transition: color 0.2s;
}
.book-quote:hover { color: var(--text); }
.book-quote.highlighted { color: var(--gold); }

.podcast-card {
  max-width: 600px;
  background: linear-gradient(135deg, rgba(212,160,23,0.08), rgba(192,120,48,0.04));
  border: 1px solid rgba(212,160,23,0.2);
  border-radius: var(--radius);
  padding: 36px;
  margin-bottom: 64px;
  text-align: center;
}
.podcast-name {
  font-size: 22px;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 8px;
}
.podcast-hosts {
  font-family: var(--sans);
  font-size: 14px;
  color: var(--text-dim);
  margin-bottom: 16px;
}
.podcast-ep {
  font-size: 16px;
  color: var(--text);
  font-style: italic;
}

.final-slogan {
  font-size: clamp(32px, 7vw, 72px);
  font-weight: 900;
  text-align: center;
  background: linear-gradient(135deg, var(--gold-light), var(--gold), var(--amber));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.3;
  max-width: 700px;
}

/* ===== CLICKABLE QUOTES ===== */
.clickable-quote {
  cursor: pointer;
  transition: all 0.25s ease;
  user-select: none;
}
.clickable-quote::after {
  content: ' ÁÇπÂáªÊî∂Ëóè';
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-muted);
  opacity: 0;
  transition: opacity 0.2s;
}
.clickable-quote:hover::after { opacity: 1; }
.clickable-quote.highlighted::after {
  content: ' ‚úì Â∑≤Êî∂Ëóè';
  color: var(--gold);
  opacity: 1;
}

/* ===== SAVED QUOTES PANEL ===== */
#saved-panel {
  position: fixed;
  bottom: 24px; right: 24px;
  background: var(--bg3);
  border: 1px solid rgba(212,160,23,0.3);
  border-radius: var(--radius);
  padding: 20px;
  max-width: 320px;
  max-height: 400px;
  overflow-y: auto;
  z-index: 900;
  display: none;
  font-family: var(--sans);
  box-shadow: 0 16px 48px rgba(0,0,0,0.5);
}
#saved-panel h4 { color: var(--gold); font-size: 13px; margin-bottom: 12px; letter-spacing: 2px; }
.saved-quote-item { font-size: 12px; color: var(--text-dim); line-height: 1.7; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
#saved-toggle {
  position: fixed;
  bottom: 24px; right: 24px;
  width: 48px; height: 48px;
  border-radius: 50%;
  background: var(--gold);
  color: var(--bg);
  border: none;
  font-size: 20px;
  cursor: pointer;
  z-index: 901;
  display: none;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 16px rgba(212,160,23,0.4);
  transition: transform 0.2s;
}
#saved-toggle:hover { transform: scale(1.1); }
#saved-count {
  position: absolute;
  top: -4px; right: -4px;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--danger);
  color: white;
  font-size: 10px;
  font-weight: 700;
  display: flex; align-items: center; justify-content: center;
}

/* ===== CONTENT OVERVIEW ===== */
.overview-blocks { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 960px; margin-bottom: 40px; }
.overview-block { background: var(--bg3); border: 1px solid rgba(212,160,23,0.1); border-radius: var(--radius); padding: 24px; text-align: center; transition: border-color 0.3s, transform 0.3s; }
.overview-block:hover { border-color: rgba(212,160,23,0.35); transform: translateY(-4px); }
.overview-block-icon { font-size: 36px; margin-bottom: 12px; display: block; }
.overview-block-title { font-size: 18px; font-weight: 700; color: var(--gold); margin-bottom: 8px; font-family: var(--sans); }
.overview-block-summary { font-family: var(--sans); font-size: 13px; color: var(--text-dim); line-height: 1.7; }

.overview-connections { max-width: 800px; margin: 32px 0 48px; }
.overview-connection { display: flex; align-items: center; gap: 12px; padding: 8px 0; font-family: var(--sans); font-size: 13px; color: var(--text-dim); }
.overview-connection-arrow { color: var(--gold); font-size: 16px; }
.overview-connection-relation { background: rgba(212,160,23,0.15); color: var(--gold); padding: 2px 10px; border-radius: 100px; font-size: 11px; font-weight: 600; }

/* ===== MIND MAP ===== */
.mindmap-container { max-width: 900px; margin: 48px 0; }
.mindmap-center { text-align: center; margin-bottom: 32px; }
.mindmap-center-label { font-size: clamp(20px, 3vw, 28px); font-weight: 800; color: var(--gold); }
.mindmap-branches { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; }
.mindmap-branch { background: var(--bg3); border-radius: var(--radius); padding: 20px; border-top: 3px solid var(--gold); }
.mindmap-branch-label { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 12px; font-family: var(--sans); }
.mindmap-branch-detail { font-family: var(--sans); font-size: 12px; color: var(--text-dim); margin-bottom: 12px; line-height: 1.6; }
.mindmap-leaves { display: flex; flex-direction: column; gap: 6px; }
.mindmap-leaf { font-family: var(--sans); font-size: 12px; color: var(--text-muted); padding-left: 16px; border-left: 2px solid rgba(212,160,23,0.2); line-height: 1.5; }
.mindmap-leaf-detail { font-size: 11px; color: var(--text-muted); opacity: 0.7; }

/* ===== ARGUMENTS ===== */
.argument-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 960px; }
.argument-card { background: var(--bg3); border-radius: var(--radius); padding: 24px; border-left: 3px solid var(--gold); }
.argument-card[data-strength="moderate"] { border-left-color: var(--amber); }
.argument-card[data-strength="anecdotal"] { border-left-color: var(--text-muted); }
.argument-claim { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 10px; line-height: 1.5; }
.argument-badge { display: inline-block; font-family: var(--sans); font-size: 10px; letter-spacing: 1px; color: var(--gold); background: rgba(212,160,23,0.12); padding: 3px 10px; border-radius: 100px; margin-bottom: 10px; text-transform: uppercase; }
.argument-evidence { font-family: var(--sans); font-size: 13px; color: var(--text-dim); line-height: 1.7; }

/* ===== CONCEPTS ===== */
.concept-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 960px; }
.concept-card { background: var(--bg3); border: 1px solid rgba(212,160,23,0.1); border-radius: var(--radius); padding: 24px; }
.concept-term { font-size: 20px; font-weight: 700; color: var(--gold); margin-bottom: 8px; font-family: var(--sans); }
.concept-definition { font-family: var(--sans); font-size: 14px; color: var(--text); line-height: 1.7; margin-bottom: 12px; }
.concept-details { border: none; }
.concept-details summary { font-family: var(--sans); font-size: 12px; color: var(--gold); cursor: pointer; padding: 4px 0; letter-spacing: 1px; }
.concept-details summary:hover { color: var(--gold-light); }
.concept-details[open] summary { margin-bottom: 12px; }
.concept-explanation { font-family: var(--sans); font-size: 13px; color: var(--text-dim); line-height: 1.8; margin-bottom: 12px; }
.concept-examples { list-style: none; padding: 0; }
.concept-examples li { font-family: var(--sans); font-size: 12px; color: var(--text-muted); padding: 4px 0 4px 16px; border-left: 2px solid rgba(212,160,23,0.15); margin-bottom: 4px; line-height: 1.6; }
.concept-related { font-family: var(--sans); font-size: 11px; color: var(--text-muted); margin-top: 8px; }
.concept-related a, .concept-related span { color: var(--gold); text-decoration: none; cursor: default; }

/* ===== EXTENDED READING ===== */
.reading-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; max-width: 960px; }
.reading-card { background: var(--bg3); border-radius: var(--radius); padding: 28px; border-left: 3px solid #4a9; }
.reading-topic { font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 8px; font-family: var(--sans); }
.reading-context { font-family: var(--sans); font-size: 12px; color: var(--amber); margin-bottom: 12px; line-height: 1.6; font-style: italic; }
.reading-dive { font-family: var(--sans); font-size: 14px; color: var(--text-dim); line-height: 1.8; margin-bottom: 12px; }
.reading-resources { font-family: var(--sans); font-size: 12px; color: var(--text-muted); padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.05); }
.reading-resources::before { content: 'üìö '; }

/* ===== POINT GROUPS (structured key_points) ===== */
.point-groups { display: flex; flex-direction: column; gap: 16px; max-width: 800px; margin-bottom: 48px; }
.point-group { background: var(--bg3); border-radius: var(--radius); padding: 20px 24px; border: 1px solid rgba(212,160,23,0.08); }
.point-group-label {
  font-family: var(--sans); font-size: 16px; font-weight: 700; color: var(--gold);
  letter-spacing: 1px;
  margin-bottom: 14px; padding-bottom: 10px;
  border-bottom: 1px solid rgba(212,160,23,0.12);
  display: flex; align-items: center; gap: 10px;
}
.point-group-num {
  display: inline-flex; align-items: center; justify-content: center;
  width: 24px; height: 24px; border-radius: 6px;
  background: rgba(212,160,23,0.15); color: var(--gold);
  font-size: 12px; font-weight: 700; flex-shrink: 0;
  font-family: var(--sans);
}
.point-item { padding: 8px 0 8px 16px; border-left: 2px solid rgba(212,160,23,0.15); margin-bottom: 2px; transition: border-color 0.2s; }
.point-item:hover { border-left-color: var(--gold); }
.point-item:first-child { border-left-color: var(--gold); padding: 10px 16px; background: rgba(212,160,23,0.04); border-radius: 0 8px 8px 0; margin-bottom: 4px; }
.point-text { font-family: var(--sans); font-size: 15px; color: var(--text); line-height: 1.6; }
.point-item:first-child .point-text { font-size: 16px; font-weight: 600; color: var(--text); }
.point-detail { font-family: var(--sans); font-size: 12px; color: var(--text-dim); line-height: 1.6; margin-top: 4px; display: block; }

/* ===== DIAGRAM COMPONENTS ===== */

/* Shared diagram wrapper */
.diagram-box {
  max-width: 800px;
  margin: 32px 0 40px;
  padding: 32px;
  background: var(--bg3);
  border-radius: var(--radius);
  border: 1px solid rgba(212,160,23,0.08);
}
.diagram-title {
  font-family: var(--sans);
  font-size: 13px;
  font-weight: 700;
  color: var(--gold);
  letter-spacing: 1px;
  margin-bottom: 8px;
}
.diagram-desc {
  font-family: var(--sans);
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 24px;
  font-style: italic;
}

/* Flow diagram ‚Äî horizontal steps with arrows */
.diagram-flow {
  display: flex;
  align-items: center;
  gap: 0;
  overflow-x: auto;
  padding: 8px 0;
}
.diagram-flow-step {
  flex: 1;
  min-width: 100px;
  text-align: center;
  position: relative;
}
.diagram-flow-step-inner {
  background: rgba(212,160,23,0.08);
  border: 1px solid rgba(212,160,23,0.2);
  border-radius: 10px;
  padding: 16px 12px;
  transition: border-color 0.3s;
}
.diagram-flow-step-inner:hover { border-color: var(--gold); }
.diagram-flow-label {
  font-family: var(--sans);
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}
.diagram-flow-desc {
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-dim);
  line-height: 1.5;
}
.diagram-flow-arrow {
  flex-shrink: 0;
  width: 40px;
  text-align: center;
  color: var(--gold);
  font-size: 18px;
  opacity: 0.6;
}

/* Comparison diagram ‚Äî left vs right */
.diagram-comparison {
  display: flex;
  flex-direction: column;
  gap: 0;
}
.diagram-comparison-header {
  display: grid;
  grid-template-columns: 1fr 40px 1fr;
  gap: 0;
  margin-bottom: 16px;
}
.diagram-comparison-header-left,
.diagram-comparison-header-right {
  font-family: var(--sans);
  font-size: 13px;
  font-weight: 700;
  padding: 10px 16px;
  border-radius: 8px;
  text-align: center;
}
.diagram-comparison-header-left {
  background: rgba(192,64,64,0.12);
  color: #e06060;
}
.diagram-comparison-header-right {
  background: rgba(212,160,23,0.12);
  color: var(--gold);
}
.diagram-comparison-header-vs {
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-muted);
  font-weight: 700;
}
.diagram-comparison-row {
  display: grid;
  grid-template-columns: 1fr 40px 1fr;
  gap: 0;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.diagram-comparison-row:last-child { border-bottom: none; }
.diagram-comparison-left,
.diagram-comparison-right {
  font-family: var(--sans);
  font-size: 13px;
  line-height: 1.6;
  padding: 0 16px;
}
.diagram-comparison-left { color: var(--text-dim); text-align: right; }
.diagram-comparison-right { color: var(--text); }
.diagram-comparison-arrow {
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--gold);
  font-size: 16px;
  opacity: 0.5;
}

/* Icon-list diagram ‚Äî emoji grid */
.diagram-icon-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 16px;
}
.diagram-icon-item {
  text-align: center;
  padding: 16px 8px;
  background: rgba(255,255,255,0.02);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.04);
  transition: border-color 0.3s, transform 0.2s;
}
.diagram-icon-item:hover { border-color: rgba(212,160,23,0.2); transform: translateY(-2px); }
.diagram-icon-emoji { font-size: 28px; margin-bottom: 8px; }
.diagram-icon-label {
  font-family: var(--sans);
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
}
.diagram-icon-desc {
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-dim);
  line-height: 1.4;
}

/* Slope diagram ‚Äî ascending visual */
.diagram-slope {
  display: flex;
  align-items: flex-end;
  gap: 0;
  height: 180px;
  padding: 0 20px 20px;
  position: relative;
}
.diagram-slope::after {
  content: '';
  position: absolute;
  bottom: 20px;
  left: 20px; right: 20px;
  height: 2px;
  background: linear-gradient(90deg, rgba(212,160,23,0.1), rgba(212,160,23,0.3), rgba(212,160,23,0.1));
}
.diagram-slope-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  position: relative;
  z-index: 1;
}
.diagram-slope-bar {
  width: 60px;
  border-radius: 8px 8px 0 0;
  margin-bottom: 12px;
  transition: height 0.6s ease;
}
.diagram-slope-bar.low { height: 40px; background: rgba(74,153,153,0.3); border: 1px solid rgba(74,153,153,0.4); border-bottom: none; }
.diagram-slope-bar.barrier { height: 100px; background: rgba(192,64,64,0.2); border: 1px solid rgba(192,64,64,0.3); border-bottom: none; }
.diagram-slope-bar.high { height: 140px; background: rgba(212,160,23,0.15); border: 1px solid rgba(212,160,23,0.25); border-bottom: none; }
.diagram-slope-label {
  font-family: var(--sans);
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  text-align: center;
}

/* Layers diagram ‚Äî concentric depth */
.diagram-layers {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  padding: 12px 0;
}
.diagram-layer {
  text-align: center;
  padding: 16px 24px;
  border-radius: 12px;
  position: relative;
  transition: transform 0.2s;
}
.diagram-layer:hover { transform: scale(1.02); }
.diagram-layer-1 {
  width: 100%;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
  padding: 20px 24px 50px;
}
.diagram-layer-2 {
  width: 85%;
  background: rgba(192,120,48,0.06);
  border: 1px solid rgba(192,120,48,0.15);
  padding: 20px 24px 50px;
  margin-top: -36px;
}
.diagram-layer-3 {
  width: 70%;
  background: rgba(212,160,23,0.1);
  border: 1px solid rgba(212,160,23,0.25);
  padding: 20px 24px;
  margin-top: -36px;
}
.diagram-layer-label {
  font-family: var(--sans);
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}
.diagram-layer-desc {
  font-family: var(--sans);
  font-size: 12px;
  color: var(--text-dim);
  line-height: 1.5;
}

/* Comparison visual_type in point-groups */
.point-group-comparison {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.pg-comparison-header {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 4px;
}
.pg-comparison-header span {
  font-family: var(--sans);
  font-size: 11px;
  font-weight: 700;
  text-align: center;
  padding: 6px;
  border-radius: 6px;
}
.pg-comparison-header span:first-child { background: rgba(192,64,64,0.1); color: #e06060; }
.pg-comparison-header span:last-child { background: rgba(212,160,23,0.1); color: var(--gold); }
.pg-comparison-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.03);
}
.pg-comparison-row:last-child { border-bottom: none; }
.pg-comparison-left, .pg-comparison-right {
  font-family: var(--sans);
  font-size: 13px;
  line-height: 1.6;
  padding: 8px 12px;
  border-radius: 6px;
}
.pg-comparison-left { background: rgba(192,64,64,0.04); color: var(--text-dim); text-decoration: line-through; text-decoration-color: rgba(192,64,64,0.3); }
.pg-comparison-right { background: rgba(212,160,23,0.04); color: var(--text); }

/* Flow visual_type in point-groups */
.point-group-flow {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
  padding: 8px 0;
}
.pg-flow-step {
  flex: 1;
  min-width: 80px;
  text-align: center;
  padding: 12px 8px;
  background: rgba(212,160,23,0.06);
  border: 1px solid rgba(212,160,23,0.12);
  border-radius: 8px;
}
.pg-flow-step .point-text { font-size: 13px; }
.pg-flow-arrow {
  color: var(--gold);
  font-size: 14px;
  opacity: 0.5;
  flex-shrink: 0;
}

/* ===== SECTION CONTEXT ===== */
.section-context { font-family: var(--sans); font-size: 12px; color: var(--text-muted); font-style: italic; margin-bottom: 24px; padding-left: 16px; border-left: 2px solid rgba(212,160,23,0.1); line-height: 1.6; }

/* ===== SIDEBAR NAV ===== */
#side-nav {
  position: fixed;
  left: 0; top: 0;
  width: 220px; height: 100vh;
  background: rgba(10,10,15,0.92);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-right: 1px solid rgba(212,160,23,0.08);
  z-index: 998;
  padding: 24px 0 40px;
  overflow-y: auto;
  transition: opacity 0.4s ease, transform 0.4s ease;
}
#side-nav.hero-mode {
  opacity: 0;
  pointer-events: none;
  transform: translateX(-20px);
}
#side-nav::-webkit-scrollbar { width: 2px; }
#side-nav::-webkit-scrollbar-thumb { background: rgba(212,160,23,0.2); border-radius: 2px; }

/* Nav header */
.nav-header {
  padding: 0 20px 20px;
  border-bottom: 1px solid rgba(212,160,23,0.08);
  margin-bottom: 12px;
}
.nav-header-title {
  font-family: var(--sans);
  font-size: 11px;
  letter-spacing: 3px;
  color: var(--gold);
  text-transform: uppercase;
  opacity: 0.8;
}
.nav-header-ep {
  font-family: var(--sans);
  font-size: 10px;
  color: var(--text-muted);
  margin-top: 4px;
}

/* Nav toggle (mobile only) */
.nav-toggle {
  position: fixed;
  left: 16px; top: 16px;
  width: 36px; height: 36px;
  background: rgba(10,10,15,0.85);
  border: 1px solid rgba(212,160,23,0.2);
  border-radius: 8px;
  color: var(--gold);
  font-size: 16px;
  cursor: pointer;
  z-index: 999;
  display: none;
  align-items: center; justify-content: center;
  transition: background 0.2s;
}
.nav-toggle:hover { background: rgba(212,160,23,0.1); }

/* Nav groups and items */
.nav-group { margin-bottom: 4px; }
.nav-group-label {
  font-family: var(--sans);
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text-muted);
  text-transform: uppercase;
  padding: 14px 20px 6px;
  opacity: 0.7;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 7px 16px 7px 20px;
  font-family: var(--sans);
  font-size: 12px;
  color: var(--text-dim);
  cursor: pointer;
  transition: all 0.2s ease;
  border-left: 2px solid transparent;
  line-height: 1.4;
  position: relative;
}
.nav-item:hover { color: var(--text); background: rgba(255,255,255,0.02); }
.nav-item.active {
  color: var(--gold);
  border-left-color: var(--gold);
  background: rgba(212,160,23,0.05);
}
.nav-item .nav-icon {
  font-size: 14px;
  width: 20px;
  text-align: center;
  flex-shrink: 0;
}
.nav-item.secondary { font-size: 11px; color: var(--text-muted); padding-left: 28px; }
.nav-item.secondary.active { color: var(--gold); }

/* Nav progress indicator per item */
.nav-item::after {
  content: '';
  position: absolute;
  right: 8px; top: 50%;
  transform: translateY(-50%);
  width: 4px; height: 4px;
  border-radius: 50%;
  background: var(--gold);
  opacity: 0;
  transition: opacity 0.3s;
}
.nav-item.visited::after { opacity: 0.4; }
.nav-item.active::after { opacity: 1; }

/* Content offset for sidebar */
body.nav-open section { padding-left: calc(220px + 5vw); }
body.nav-open #progress-bar { left: 220px; }
body.nav-open .nav-toggle { display: none; }

/* ===== FOOTNOTES ===== */
.fn-ref {
  display: inline-flex; align-items: center; justify-content: center;
  width: 16px; height: 16px;
  font-family: var(--sans);
  font-size: 10px; font-weight: 700;
  color: var(--gold);
  background: rgba(212,160,23,0.12);
  border-radius: 50%;
  cursor: help;
  position: relative;
  vertical-align: super;
  margin-left: 2px;
  transition: background 0.2s;
}
.fn-ref:hover { background: rgba(212,160,23,0.25); }
.fn-ref .fn-tip {
  display: none;
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  width: 260px;
  padding: 12px 14px;
  background: var(--bg3);
  border: 1px solid rgba(212,160,23,0.2);
  border-radius: 8px;
  font-family: var(--sans);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-dim);
  line-height: 1.7;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5);
  z-index: 100;
  pointer-events: none;
  white-space: normal;
}
.fn-ref .fn-tip::after {
  content: '';
  position: absolute;
  top: 100%; left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: rgba(212,160,23,0.2);
}
.fn-ref:hover .fn-tip { display: block; }

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  section { padding: 60px 5vw; }
  .feature-cards, .story-cards, .book-cards { grid-template-columns: 1fr; }
  .author-grid { grid-template-columns: 1fr; }
  .overview-blocks, .mindmap-branches, .argument-cards, .concept-cards, .reading-cards { grid-template-columns: 1fr; }
  body.nav-open section { padding-left: 5vw; }
  body.nav-open #progress-bar { left: 0; }
  #side-nav {
    width: 260px;
    transform: translateX(-100%);
    box-shadow: 4px 0 24px rgba(0,0,0,0.5);
  }
  #side-nav.mobile-open { transform: translateX(0); }
  .nav-toggle { display: flex !important; }
  .fn-ref .fn-tip { width: 200px; left: auto; right: -20px; transform: none; }
  .fn-ref .fn-tip::after { left: auto; right: 24px; }
  .point-groups { gap: 20px; }
  .diagram-flow { flex-direction: column; gap: 8px; }
  .diagram-flow-arrow { transform: rotate(90deg); width: auto; }
  .diagram-flow-step { min-width: 0; }
  .diagram-comparison-header, .diagram-comparison-row { grid-template-columns: 1fr 24px 1fr; }
  .diagram-icon-list { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
  .diagram-slope { height: 140px; }
  .diagram-layer-1, .diagram-layer-2, .diagram-layer-3 { width: 100%; }
  .pg-comparison-header, .pg-comparison-row { grid-template-columns: 1fr 1fr; gap: 8px; }
  .point-group-flow { flex-direction: column; }
}
</style>
</head>
<body>

<div id="progress-bar"></div>

<button class="nav-toggle" id="nav-toggle" aria-label="ÂØºËà™">‚ò∞</button>
<nav id="side-nav">
  <div class="nav-header">
    <div class="nav-header-title">{{ meta.podcast_name | default('Êí≠ÂÆ¢ÂèØËßÜÂåñ') }}</div>
    <div class="nav-header-ep">{%- if meta.episode_number %}EP.{{ meta.episode_number }} ¬∑ {% endif %}{{ meta.title | default('') }}</div>
  </div>

  <div class="nav-group">
    <div class="nav-item" data-section="hero"><span class="nav-icon">‚óé</span> ÂºÄÂú∫</div>
    <div class="nav-item" data-section="participants"><span class="nav-icon">üë§</span> ÂòâÂÆæ‰ªãÁªç</div>
  </div>

  {% if content_overview is defined and content_overview.content_blocks %}
  <div class="nav-group">
    <div class="nav-group-label">ÂÜÖÂÆπËÑâÁªú</div>
    <div class="nav-item" data-section="content-overview"><span class="nav-icon">üó∫</span> ÂÖ®Â±ÄÊ¶ÇËßà</div>
    {% for block in content_overview.content_blocks %}
    <div class="nav-item" data-section="{{ block.section_ids[0] }}"><span class="nav-icon">{{ block.icon | default('¬∑') }}</span> {{ block.title }}</div>
    {% endfor %}
  </div>
  {% else %}
  <div class="nav-group">
    <div class="nav-group-label">ÂÜÖÂÆπ</div>
    {% for section in sections if not section.is_ad %}
    <div class="nav-item" data-section="{{ section.id }}">{{ section.title }}</div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="nav-group">
    <div class="nav-group-label">Ê∑±Â∫¶ÂàÜÊûê</div>
    {% if arguments %}<div class="nav-item secondary" data-section="arguments">Ê†∏ÂøÉËßÇÁÇπ</div>{% endif %}
    {% if key_concepts %}<div class="nav-item secondary" data-section="concepts">ÂÖ≥ÈîÆÊ¶ÇÂøµ</div>{% endif %}
    {% if extended_reading %}<div class="nav-item secondary" data-section="extended-reading">Âª∂‰º∏Êé¢Á¥¢</div>{% endif %}
  </div>

  <div class="nav-group">
    <div class="nav-group-label">‰∫íÂä®</div>
    <div class="nav-item secondary" data-section="quiz">Ëá™Êµã‰∏Ä‰∏ã</div>
    <div class="nav-item secondary" data-section="ending">ÁªìÂ∞æ</div>
  </div>
</nav>

<button id="saved-toggle" title="Êü•ÁúãÂ∑≤Êî∂Ëóè">‚òÖ<span id="saved-count">0</span></button>
<div id="saved-panel">
  <h4>‚≠ê ÊàëÁöÑÈáëÂè•Êî∂Ëóè</h4>
  <div id="saved-list"></div>
</div>

<!-- ===== 1. HERO ===== -->
<section id="hero">
  <div class="hero-ep reveal">
    {%- if meta.episode_number %}EP.{{ meta.episode_number }} ¬∑ {% endif %}{{ meta.podcast_name }}
  </div>
  <h1 class="hero-title reveal reveal-delay-1">{{ meta.title }}</h1>
  <p class="hero-subtitle reveal reveal-delay-2">
    {{ meta.subtitle }}{% if meta.subtitle %}<br>{% endif %}
    <span style="color:var(--text-muted);font-size:12px;">
      {%- for p in participants %}{{ p.name }}{% if not loop.last %} √ó {% endif %}{% endfor %} ¬∑ {{ meta.podcast_name }}
    </span>
  </p>
  {% if core_quotes %}
  <blockquote class="hero-quote reveal reveal-delay-3 clickable-quote" data-quote="{{ core_quotes[0] | e }}">
    {{ core_quotes[0] }}
  </blockquote>
  {% endif %}
  <div class="scroll-hint reveal reveal-delay-4">
    <span>Âêë‰∏ãÊé¢Á¥¢</span>
    <div class="scroll-arrow"></div>
  </div>
</section>

<!-- ===== 2. PARTICIPANTS ===== -->
<section id="participants" style="background:var(--bg2);">
  <div class="section-label reveal">ËäÇÁõÆÂòâÂÆæ</div>
  <h2 class="section-title reveal">
    {%- for p in participants %}{{ p.name }}{% if not loop.last %} √ó {% endif %}{% endfor %}
  </h2>
  <div class="section-divider reveal"></div>

  <div class="author-grid reveal">
    {% for p in participants %}
    <div class="author-card">
      <h3>{{ p.name }}</h3>
      <p>{{ p.bio if p.bio else p.role }}</p>
    </div>
    {% endfor %}
    {% if featured_work is defined and featured_work %}
    <div class="author-card">
      <h3>Êú¨Êúü{% if featured_work.type == 'book' %}‰π¶ÁõÆ{% elif featured_work.type == 'film' %}ÂΩ±Áâá{% else %}‰∏ªÈ¢ò{% endif %}</h3>
      <p style="color:var(--gold);font-size:16px;font-weight:700;">{{ featured_work.title }}</p>
      {% if featured_work.author %}
      <p style="margin-top:6px;font-size:13px;color:var(--text-muted);">{{ featured_work.author }}{% if featured_work.year %} ¬∑ {{ featured_work.year }}{% endif %}</p>
      {% endif %}
      {% if featured_work.description %}
      <p style="margin-top:10px;font-style:italic;">{{ featured_work.description }}</p>
      {% endif %}
    </div>
    {% endif %}
  </div>
</section>

<!-- ===== CONTENT OVERVIEW ===== -->
{% if content_overview is defined and content_overview %}
<section id="content-overview" style="background:var(--bg);">
  {% if content_overview.one_sentence_summary is defined and content_overview.one_sentence_summary %}
  <blockquote class="big-quote reveal">
    {{ content_overview.one_sentence_summary }}
  </blockquote>
  {% endif %}

  {% if content_overview.content_blocks is defined and content_overview.content_blocks %}
  <div class="section-label reveal">ÂÜÖÂÆπÊ¶ÇËßà</div>
  <div class="overview-blocks reveal">
    {% for block in content_overview.content_blocks %}
    <div class="overview-block">
      <span class="overview-block-icon">{{ block.icon | default('üìå') }}</span>
      <div class="overview-block-title">{{ block.title | default('') }}</div>
      <div class="overview-block-summary">{{ block.summary | default('') }}</div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if content_overview.block_connections is defined and content_overview.block_connections %}
  <div class="overview-connections reveal">
    {% for conn in content_overview.block_connections %}
    <div class="overview-connection">
      <span>{{ conn.from | default('') }}</span>
      <span class="overview-connection-arrow">‚Üí</span>
      <span class="overview-connection-relation">{{ conn.relation | default('') }}</span>
      <span class="overview-connection-arrow">‚Üí</span>
      <span>{{ conn.to | default('') }}</span>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if mind_map is defined and mind_map %}
  <div class="mindmap-container reveal">
    <div class="mindmap-center">
      <div class="mindmap-center-label">{{ mind_map.central_theme | default('') }}</div>
    </div>
    {% if mind_map.branches is defined and mind_map.branches %}
    <div class="mindmap-branches">
      {% for branch in mind_map.branches %}
      <div class="mindmap-branch">
        <div class="mindmap-branch-label">{{ branch.label | default('') }}</div>
        {% if branch.detail is defined and branch.detail %}
        <div class="mindmap-branch-detail">{{ branch.detail }}</div>
        {% endif %}
        {% if branch.children is defined and branch.children %}
        <div class="mindmap-leaves">
          {% for leaf in branch.children %}
          <div class="mindmap-leaf">
            {% if leaf is mapping %}
            {{ leaf.label | default('') }}
            {% if leaf.detail is defined and leaf.detail %}
            <div class="mindmap-leaf-detail">{{ leaf.detail }}</div>
            {% endif %}
            {% else %}
            {{ leaf }}
            {% endif %}
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
  {% endif %}
</section>
{% endif %}

<!-- ===== 3+. CONTENT SECTIONS ===== -->
{% for section in sections if not section.is_ad %}
<section id="{{ section.id }}" style="background:var(--bg{{ '' if loop.index0 % 2 == 0 else '2' }});">

{% if loop.first %}
  {# ---- Á¨¨‰∏ÄÁ´†ËäÇÔºöintro È£éÊ†ºÔºàÂÖ®Â±èÂ§ßÂ≠óÂºïË®ÄÔºâ---- #}
  <div class="section-label reveal">{{ section.subtitle or meta.podcast_name }}</div>
  <h2 class="section-title reveal" style="font-size:clamp(28px,5vw,56px);">{{ section.title }}</h2>
  <div class="section-divider reveal"></div>

  {% if section.section_context is defined and section.section_context %}
  <div class="section-context reveal">{{ section.section_context }}</div>
  {% endif %}

  {% if section.quotes %}
  <blockquote class="hero-quote reveal reveal-delay-1 clickable-quote" style="margin-bottom:40px;" data-quote="{{ section.quotes[0] | e }}">
    {{ section.quotes[0] }}
  </blockquote>
  {% endif %}

  {% if section.diagram is defined and section.diagram %}
  <div class="diagram-box reveal reveal-delay-2">
    <div class="diagram-title">{{ section.diagram.title }}</div>
    {% if section.diagram.description %}<div class="diagram-desc">{{ section.diagram.description }}</div>{% endif %}
    {% if section.diagram.type == 'flow' and section.diagram.steps is defined %}
    <div class="diagram-flow">
      {% for step in section.diagram.steps %}
      {% if not loop.first %}<div class="diagram-flow-arrow">‚Üí</div>{% endif %}
      <div class="diagram-flow-step"><div class="diagram-flow-step-inner"><div class="diagram-flow-label">{{ step.label }}</div><div class="diagram-flow-desc">{{ step.desc | default('') }}</div></div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'comparison' and section.diagram.left is defined and section.diagram.entries is defined %}
    <div class="diagram-comparison">
      <div class="diagram-comparison-header"><div class="diagram-comparison-header-left">{{ section.diagram.left.label }}</div><div class="diagram-comparison-header-vs">VS</div><div class="diagram-comparison-header-right">{{ section.diagram.right.label }}</div></div>
      {% for entry in section.diagram.entries %}
      <div class="diagram-comparison-row"><div class="diagram-comparison-left">{{ entry.left }}</div><div class="diagram-comparison-arrow">‚Üí</div><div class="diagram-comparison-right">{{ entry.right }}</div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'icon-list' and section.diagram.entries is defined %}
    <div class="diagram-icon-list">
      {% for entry in section.diagram.entries %}
      <div class="diagram-icon-item"><div class="diagram-icon-emoji">{{ entry.icon }}</div><div class="diagram-icon-label">{{ entry.label }}</div><div class="diagram-icon-desc">{{ entry.desc | default('') }}</div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'slope' and section.diagram.elements is defined %}
    <div class="diagram-slope">
      {% for el in section.diagram.elements %}
      <div class="diagram-slope-item"><div class="diagram-slope-bar {{ el.level }}"></div><div class="diagram-slope-label">{{ el.label }}</div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'layers' and section.diagram.layers is defined %}
    <div class="diagram-layers">
      {% for layer in section.diagram.layers %}
      <div class="diagram-layer diagram-layer-{{ layer.depth }}"><div class="diagram-layer-label">{{ layer.label }}</div><div class="diagram-layer-desc">{{ layer.desc | default('') }}</div></div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
  {% endif %}

  {% if section.key_points_grouped is defined and section.key_points_grouped %}
  {% set ns = namespace(fn_counter=1) %}
  <div class="point-groups reveal reveal-delay-2">
    {% for group in section.key_points_grouped %}
    {% set vt = group.visual_type | default('list') %}
    <div class="point-group">
      <div class="point-group-label"><span class="point-group-num">{{ loop.index }}</span>{{ group.label | default(group.group_title | default('')) }}</div>
      {% if vt == 'comparison' and group.comparisons is defined %}
      <div class="point-group-comparison">
        <div class="pg-comparison-header"><span>{{ group.left_label | default('Before') }}</span><span>{{ group.right_label | default('After') }}</span></div>
        {% for c in group.comparisons %}
        <div class="pg-comparison-row"><div class="pg-comparison-left">{{ c.left }}</div><div class="pg-comparison-right">{{ c.right }}</div></div>
        {% endfor %}
      </div>
      {% elif vt == 'flow' and group.points is defined %}
      <div class="point-group-flow">
        {% for point in group.points %}
        {% if not loop.first %}<span class="pg-flow-arrow">‚Üí</span>{% endif %}
        <div class="pg-flow-step"><span class="point-text">{%- if point is mapping %}{{ point.text }}{% else %}{{ point }}{% endif -%}</span></div>
        {% endfor %}
      </div>
      {% else %}
      {% for point in group.points | default([]) %}
      <div class="point-item">
        <span class="point-text">
          {%- if point is mapping %}{{ point.text }}{% else %}{{ point }}{% endif -%}
          {%- if point is mapping and point.detail %}<span class="fn-ref">{{ ns.fn_counter }}<span class="fn-tip">{{ point.detail }}</span></span>{% set ns.fn_counter = ns.fn_counter + 1 %}{% endif -%}
        </span>
      </div>
      {% endfor %}
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% elif section.key_points %}
  <div class="action-items reveal reveal-delay-2">
    {% for point in section.key_points %}
    <div class="action-item">
      <div class="action-num">{{ loop.index }}</div>
      <span>{{ point }}</span>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if section.stories %}
  <div class="story-cards reveal reveal-delay-3" style="margin-top:40px;">
    {% for story in section.stories %}
    <div class="story-card">
      {% if story is mapping %}
      <div class="narrator">{{ story.narrator_id }}</div>
      <p>{{ story.text }}</p>
      {% else %}
      <p>{{ story }}</p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

{% else %}
  {# ---- ÈÄöÁî®ÂÜÖÂÆπÁ´†ËäÇÔºàÂ§ßÂºïË®Ä + Ë¶ÅÁÇπ + ÊïÖ‰∫ãÔºâ---- #}
  <div class="section-label reveal">{{ section.subtitle or '' }}</div>
  <h2 class="section-title reveal">{{ section.title }}</h2>
  <div class="section-divider reveal"></div>

  {% if section.section_context is defined and section.section_context %}
  <div class="section-context reveal">{{ section.section_context }}</div>
  {% endif %}

  {% if section.quotes %}
  <blockquote class="big-quote reveal clickable-quote" data-quote="{{ section.quotes[0] | e }}">
    {{ section.quotes[0] }}
  </blockquote>
  {% endif %}

  {% if section.diagram is defined and section.diagram %}
  <div class="diagram-box reveal">
    <div class="diagram-title">{{ section.diagram.title }}</div>
    {% if section.diagram.description %}<div class="diagram-desc">{{ section.diagram.description }}</div>{% endif %}
    {% if section.diagram.type == 'flow' and section.diagram.steps is defined %}
    <div class="diagram-flow">
      {% for step in section.diagram.steps %}
      {% if not loop.first %}<div class="diagram-flow-arrow">‚Üí</div>{% endif %}
      <div class="diagram-flow-step"><div class="diagram-flow-step-inner"><div class="diagram-flow-label">{{ step.label }}</div><div class="diagram-flow-desc">{{ step.desc | default('') }}</div></div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'comparison' and section.diagram.left is defined and section.diagram.entries is defined %}
    <div class="diagram-comparison">
      <div class="diagram-comparison-header"><div class="diagram-comparison-header-left">{{ section.diagram.left.label }}</div><div class="diagram-comparison-header-vs">VS</div><div class="diagram-comparison-header-right">{{ section.diagram.right.label }}</div></div>
      {% for entry in section.diagram.entries %}
      <div class="diagram-comparison-row"><div class="diagram-comparison-left">{{ entry.left }}</div><div class="diagram-comparison-arrow">‚Üí</div><div class="diagram-comparison-right">{{ entry.right }}</div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'icon-list' and section.diagram.entries is defined %}
    <div class="diagram-icon-list">
      {% for entry in section.diagram.entries %}
      <div class="diagram-icon-item"><div class="diagram-icon-emoji">{{ entry.icon }}</div><div class="diagram-icon-label">{{ entry.label }}</div><div class="diagram-icon-desc">{{ entry.desc | default('') }}</div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'slope' and section.diagram.elements is defined %}
    <div class="diagram-slope">
      {% for el in section.diagram.elements %}
      <div class="diagram-slope-item"><div class="diagram-slope-bar {{ el.level }}"></div><div class="diagram-slope-label">{{ el.label }}</div></div>
      {% endfor %}
    </div>
    {% elif section.diagram.type == 'layers' and section.diagram.layers is defined %}
    <div class="diagram-layers">
      {% for layer in section.diagram.layers %}
      <div class="diagram-layer diagram-layer-{{ layer.depth }}"><div class="diagram-layer-label">{{ layer.label }}</div><div class="diagram-layer-desc">{{ layer.desc | default('') }}</div></div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
  {% endif %}

  {% if section.key_points_grouped is defined and section.key_points_grouped %}
  {% set ns = namespace(fn_counter=1) %}
  <div class="point-groups reveal">
    {% for group in section.key_points_grouped %}
    {% set vt = group.visual_type | default('list') %}
    <div class="point-group reveal{% if loop.index > 1 %} reveal-delay-{{ [loop.index - 1, 4] | min }}{% endif %}">
      <div class="point-group-label"><span class="point-group-num">{{ loop.index }}</span>{{ group.label | default(group.group_title | default('')) }}</div>
      {% if vt == 'comparison' and group.comparisons is defined %}
      <div class="point-group-comparison">
        <div class="pg-comparison-header"><span>{{ group.left_label | default('Before') }}</span><span>{{ group.right_label | default('After') }}</span></div>
        {% for c in group.comparisons %}
        <div class="pg-comparison-row"><div class="pg-comparison-left">{{ c.left }}</div><div class="pg-comparison-right">{{ c.right }}</div></div>
        {% endfor %}
      </div>
      {% elif vt == 'flow' and group.points is defined %}
      <div class="point-group-flow">
        {% for point in group.points %}
        {% if not loop.first %}<span class="pg-flow-arrow">‚Üí</span>{% endif %}
        <div class="pg-flow-step"><span class="point-text">{%- if point is mapping %}{{ point.text }}{% else %}{{ point }}{% endif -%}</span></div>
        {% endfor %}
      </div>
      {% else %}
      {% for point in group.points | default([]) %}
      <div class="point-item">
        <span class="point-text">
          {%- if point is mapping %}{{ point.text }}{% else %}{{ point }}{% endif -%}
          {%- if point is mapping and point.detail %}<span class="fn-ref">{{ ns.fn_counter }}<span class="fn-tip">{{ point.detail }}</span></span>{% set ns.fn_counter = ns.fn_counter + 1 %}{% endif -%}
        </span>
      </div>
      {% endfor %}
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% elif section.key_points %}
  <div class="action-items reveal">
    {% for point in section.key_points %}
    <div class="action-item reveal{% if loop.index > 1 %} reveal-delay-{{ [loop.index - 1, 4] | min }}{% endif %}">
      <div class="action-num">{{ loop.index }}</div>
      <span>{{ point }}</span>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if section.stories %}
  <div class="story-cards reveal" style="margin-top:40px;">
    {% for story in section.stories %}
    <div class="story-card">
      {% if story is mapping %}
      <div class="narrator">{{ story.narrator_id }}</div>
      <p>{{ story.text }}</p>
      {% else %}
      <p>{{ story }}</p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if section.quotes | length > 1 %}
  <div class="mega-quote reveal clickable-quote" data-quote="{{ section.quotes[1] | e }}">
    <span>{{ section.quotes[1] }}</span>
  </div>
  {% endif %}

{% endif %}
</section>
{% endfor %}

<!-- ===== ARGUMENTS ===== -->
{% if arguments is defined and arguments %}
<section id="arguments" style="background:var(--bg);">
  <div class="section-label reveal">Ê∑±Â∫¶Ëß£Êûê</div>
  <h2 class="section-title reveal">Ê†∏ÂøÉËßÇÁÇπ</h2>
  <div class="section-divider reveal"></div>

  <div class="argument-cards">
    {% for arg in arguments %}
    <div class="argument-card reveal{% if loop.index > 1 %} reveal-delay-{{ [loop.index - 1, 4] | min }}{% endif %}" data-strength="{{ arg.strength | default('strong') }}">
      <div class="argument-claim">{{ arg.claim | default('') }}</div>
      {% if arg.evidence_type is defined and arg.evidence_type %}
      <div class="argument-badge">{{ arg.evidence_type }}</div>
      {% endif %}
      {% if arg.evidence is defined and arg.evidence %}
      <div class="argument-evidence">{{ arg.evidence }}</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- ===== CONCEPTS ===== -->
{% if key_concepts is defined and key_concepts %}
<section id="concepts" style="background:var(--bg2);">
  <div class="section-label reveal">Áü•ËØÜÂõæË∞±</div>
  <h2 class="section-title reveal">ÂÖ≥ÈîÆÊ¶ÇÂøµ</h2>
  <div class="section-divider reveal"></div>

  <div class="concept-cards">
    {% for concept in key_concepts %}
    <div class="concept-card reveal{% if loop.index > 1 %} reveal-delay-{{ [loop.index - 1, 4] | min }}{% endif %}">
      <div class="concept-term">{{ concept.term | default('') }}</div>
      <div class="concept-definition">{{ concept.definition | default('') }}</div>
      {% if concept.explanation is defined or concept.examples is defined or concept.related_concepts is defined %}
      <details class="concept-details">
        <summary>Â±ïÂºÄËØ¶ÊÉÖ ‚ñ∏</summary>
        {% if concept.explanation is defined and concept.explanation %}
        <div class="concept-explanation">{{ concept.explanation }}</div>
        {% endif %}
        {% if concept.examples is defined and concept.examples %}
        <ul class="concept-examples">
          {% for example in concept.examples %}
          <li>{{ example }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% if concept.related_concepts is defined and concept.related_concepts %}
        <div class="concept-related">
          Áõ∏ÂÖ≥Ê¶ÇÂøµÔºö
          {% for rel in concept.related_concepts %}
          <span>{{ rel }}</span>{% if not loop.last %}„ÄÅ{% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </details>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- ===== EXTENDED READING ===== -->
{% if extended_reading is defined and extended_reading %}
<section id="extended-reading" style="background:var(--bg);">
  <div class="section-label reveal">ÊãìÂ±ïËßÜÈáé</div>
  <h2 class="section-title reveal">Âª∂‰º∏Êé¢Á¥¢</h2>
  <div class="section-divider reveal"></div>

  <div class="reading-cards">
    {% for item in extended_reading %}
    <div class="reading-card reveal{% if loop.index > 1 %} reveal-delay-{{ [loop.index - 1, 4] | min }}{% endif %}">
      <div class="reading-topic">{{ item.topic | default('') }}</div>
      {% if item.context is defined and item.context %}
      <div class="reading-context">{{ item.context }}</div>
      {% endif %}
      {% if item.deep_dive is defined and item.deep_dive %}
      <div class="reading-dive">{{ item.deep_dive }}</div>
      {% endif %}
      {% if item.further_resources is defined and item.further_resources %}
      <div class="reading-resources">{{ item.further_resources }}</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- ===== QUIZ ===== -->
<section id="quiz" style="background:var(--bg2);">
  <div class="section-label reveal">‰∫íÂä®Ëá™Êµã</div>
  <h2 class="section-title reveal">{{ quiz.intro_title | default('Ëá™Êµã‰∏Ä‰∏ã') }}</h2>
  <div class="section-divider reveal"></div>

  <div class="quiz-container reveal">
    <p class="quiz-intro">{{ quiz.intro }}</p>

    <div id="quiz-form">
      {% for q in quiz.questions %}
      <div class="quiz-question">
        <div class="quiz-q-text">{{ loop.index }}. {{ q.text }}</div>
        {% if q.type == 'choice' %}
        <div class="quiz-options">
          {% for opt in q.options %}
          <div class="quiz-opt" data-q="{{ q.id }}" data-v="{{ opt.score }}">{{ opt.label }}</div>
          {% endfor %}
        </div>
        {% elif q.type == 'slider' %}
        <input type="range" class="quiz-slider" min="0" max="3" value="1" id="slider-{{ q.id }}">
        <div class="slider-labels">
          {% for label in q.slider_labels %}
          <span>{{ label }}</span>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endfor %}

      <button class="quiz-btn" id="quiz-submit">Êü•ÁúãÁªìÊûú ‚Üí</button>
    </div>

    <div class="quiz-result" id="quiz-result">
      <div class="quiz-result-level" id="result-level"></div>
      <div class="quiz-result-desc" id="result-desc"></div>
    </div>
  </div>
</section>

<!-- ===== ENDING ===== -->
<section id="ending" style="background:var(--bg);">
  <div class="section-label reveal">Âª∂‰º∏ÈòÖËØª</div>
  <h2 class="section-title reveal">Êé®Ëçê‰π¶Âçï</h2>
  <div class="section-divider reveal"></div>

  {% if recommendations %}
  <div class="book-cards">
    {% for rec in recommendations %}
    <div class="book-card reveal{% if loop.index > 1 %} reveal-delay-{{ [loop.index - 1, 4] | min }}{% endif %}">
      <div class="book-tag">{{ rec.type | upper }}{% if rec.recommender_id %} ¬∑ {{ rec.recommender_id }}{% endif %}</div>
      <div class="book-title">{{ rec.title }}</div>
      {% if rec.author %}<div class="book-author">{{ rec.author }}</div>{% endif %}
      {% if rec.quote %}
      <div class="book-quote clickable-quote" data-quote="{{ rec.quote | e }}">{{ rec.quote }}</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="podcast-card reveal">
    <div class="podcast-name">{{ meta.podcast_name }}</div>
    <div class="podcast-hosts">
      {%- for p in participants %}{{ p.name }}{% if not loop.last %} √ó {% endif %}{% endfor %}
    </div>
    <div class="podcast-ep">
      {%- if meta.episode_number %}EP.{{ meta.episode_number }} ¬∑ {% endif %}{{ meta.title }}
    </div>
  </div>

  <div class="final-slogan reveal">
    {{ (theme.final_slogan | default(meta.podcast_name)).replace(' ', '<br>') | safe }}
  </div>

  {% if core_quotes | length > 1 %}
  <div class="reveal" style="margin-top:64px;text-align:center;">
    <blockquote class="big-quote clickable-quote"
      data-quote="{{ core_quotes[-1] | e }}"
      style="text-align:left;max-width:600px;margin:0 auto;font-size:clamp(14px,2vw,18px);">
      {{ core_quotes[-1] }}
    </blockquote>
  </div>
  {% endif %}

  <div style="height:80px;"></div>
</section>

<script>
// === Quiz ÈÖçÁΩÆÔºàÁî±Ê®°ÊùøÊ≥®ÂÖ•Ôºâ===
const QUIZ_CONFIG = {{ quiz_config | tojson }};

// === ËøõÂ∫¶Êù° ===
const progressBar = document.getElementById('progress-bar');
window.addEventListener('scroll', () => {
  const scrollTop = window.scrollY;
  const docHeight = document.documentElement.scrollHeight - window.innerHeight;
  progressBar.style.width = (scrollTop / docHeight * 100) + '%';
});

// === Intersection Observer ÊªöÂä®Âä®Áîª ===
const reveals = document.querySelectorAll('.reveal');
const revealObs = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (e.isIntersecting) e.target.classList.add('visible');
  });
}, { threshold: 0.12, rootMargin: '0px 0px -60px 0px' });
reveals.forEach(el => revealObs.observe(el));

// === ‰æßËæπÂØºËà™ ===
const sideNav = document.getElementById('side-nav');
const navToggle = document.getElementById('nav-toggle');
const navItems = document.querySelectorAll('.nav-item');
const allSections = document.querySelectorAll('section[id]');
const heroSection = document.getElementById('hero');

// Ê°åÈù¢Á´ØÔºöÈªòËÆ§Â±ïÂºÄ
const isDesktop = window.innerWidth > 768;
if (isDesktop) {
  document.body.classList.add('nav-open');
  sideNav.classList.add('hero-mode'); // ÂàùÂßãÂú® hero Âå∫Êó∂ÈöêËóè
}

// Hero Âå∫ÂèØËßÅÊÄßÊ£ÄÊµãÔºöÁ¶ªÂºÄ hero ÂêéÊòæÁ§∫ÂØºËà™
const heroObs = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (isDesktop) {
      sideNav.classList.toggle('hero-mode', e.isIntersecting);
    }
  });
}, { threshold: 0.3 });
if (heroSection) heroObs.observe(heroSection);

// ÁßªÂä®Á´ØÔºöÊ±âÂ†°ËèúÂçïÂàáÊç¢
navToggle.addEventListener('click', () => {
  sideNav.classList.toggle('mobile-open');
  navToggle.textContent = sideNav.classList.contains('mobile-open') ? '‚úï' : '‚ò∞';
});

// ÁÇπÂáªÂØºËà™È°π
navItems.forEach(item => {
  item.addEventListener('click', () => {
    const target = document.getElementById(item.dataset.section);
    if (target) {
      target.scrollIntoView({ behavior: 'smooth' });
      // ÁßªÂä®Á´ØËá™Âä®ÂÖ≥Èó≠
      if (!isDesktop) {
        sideNav.classList.remove('mobile-open');
        navToggle.textContent = '‚ò∞';
      }
    }
  });
});

// ÊªöÂä®È´ò‰∫Æ + Â∑≤ËÆøÈóÆÊ†áËÆ∞
const visitedSections = new Set();
const sectionObs = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      const id = e.target.id;
      visitedSections.add(id);
      navItems.forEach(n => {
        n.classList.remove('active');
        if (visitedSections.has(n.dataset.section)) n.classList.add('visited');
      });
      // ÊâæÂåπÈÖçÁöÑÂØºËà™È°π
      const match = document.querySelector(`.nav-item[data-section="${id}"]`);
      if (match) {
        match.classList.add('active');
        // Ëá™Âä®ÊªöÂä®ÂØºËà™ËÆ©ÂΩìÂâçÈ°πÂèØËßÅ
        match.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }
  });
}, { threshold: 0.3, rootMargin: '0px 0px -50% 0px' });
allSections.forEach(s => sectionObs.observe(s));

// === ÈáëÂè•Êî∂ËóèÁ≥ªÁªü ===
const savedQuotes = [];
const savedList = document.getElementById('saved-list');
const savedToggle = document.getElementById('saved-toggle');
const savedPanel = document.getElementById('saved-panel');
const savedCount = document.getElementById('saved-count');
let panelOpen = false;

document.querySelectorAll('.clickable-quote').forEach(el => {
  el.addEventListener('click', function(e) {
    e.stopPropagation();
    const quote = this.dataset.quote || this.textContent.trim().slice(0, 60);
    if (this.classList.contains('highlighted')) {
      this.classList.remove('highlighted');
      const idx = savedQuotes.indexOf(quote);
      if (idx > -1) savedQuotes.splice(idx, 1);
    } else {
      this.classList.add('highlighted');
      if (!savedQuotes.includes(quote)) savedQuotes.push(quote);
    }
    updateSavedPanel();
  });
});

function updateSavedPanel() {
  savedCount.textContent = savedQuotes.length;
  savedList.innerHTML = savedQuotes.map(q => `<div class="saved-quote-item">${q}</div>`).join('');
  if (savedQuotes.length > 0) {
    savedToggle.style.display = 'flex';
  } else {
    savedToggle.style.display = 'none';
    savedPanel.style.display = 'none';
    panelOpen = false;
  }
}

savedToggle.addEventListener('click', () => {
  panelOpen = !panelOpen;
  savedPanel.style.display = panelOpen ? 'block' : 'none';
  if (panelOpen) { savedPanel.style.bottom = '80px'; savedPanel.style.right = '24px'; }
});

document.addEventListener('click', (e) => {
  if (!savedPanel.contains(e.target) && e.target !== savedToggle) {
    savedPanel.style.display = 'none';
    panelOpen = false;
  }
});

// === Quiz ÈÄªËæë ===
const quizAnswers = {};

document.querySelectorAll('.quiz-opt').forEach(opt => {
  opt.addEventListener('click', function() {
    const q = this.dataset.q;
    document.querySelectorAll(`[data-q="${q}"]`).forEach(o => o.classList.remove('selected'));
    this.classList.add('selected');
    quizAnswers[q] = parseInt(this.dataset.v);
  });
});

document.getElementById('quiz-submit').addEventListener('click', () => {
  const missing = QUIZ_CONFIG.required.filter(q => !Object.prototype.hasOwnProperty.call(quizAnswers, q));
  if (missing.length > 0) {
    const btn = document.getElementById('quiz-submit');
    btn.textContent = 'ËØ∑ÂÖàÂõûÁ≠îÊâÄÊúâÈóÆÈ¢ò ‚úó';
    btn.style.background = '#c04040';
    setTimeout(() => { btn.textContent = 'Êü•ÁúãÁªìÊûú ‚Üí'; btn.style.background = ''; }, 2000);
    return;
  }

  // Êî∂ÈõÜ slider ÂÄº
  QUIZ_CONFIG.sliders.forEach(id => {
    const slider = document.getElementById('slider-' + id);
    if (slider) quizAnswers[id] = parseInt(slider.value);
  });

  let total = 0, count = 0;
  for (const v of Object.values(quizAnswers)) { total += v; count++; }
  const avgScore = count > 0 ? total / count : 0;

  // ÂåπÈÖçÁªìÊûúÂå∫Èó¥
  const results = QUIZ_CONFIG.results;
  let result = results[results.length - 1];
  for (const r of results) {
    if (avgScore <= r.max) { result = r; break; }
  }

  document.getElementById('result-level').textContent = result.label;
  document.getElementById('result-desc').textContent = result.desc;
  const resultEl = document.getElementById('quiz-result');
  resultEl.style.display = 'block';
  resultEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
});

// Slider Ê∏êÂèòËâ≤Êõ¥Êñ∞
QUIZ_CONFIG.sliders.forEach(id => {
  const slider = document.getElementById('slider-' + id);
  if (slider) {
    slider.addEventListener('input', function() {
      const pct = (this.value / 3) * 100;
      this.style.background = `linear-gradient(to right, #d4a017 0%, #d4a017 ${pct}%, #5a5248 ${pct}%, #5a5248 100%)`;
    });
  }
});
</script>
</body>
</html>
